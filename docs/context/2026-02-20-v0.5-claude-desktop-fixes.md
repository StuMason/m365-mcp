# v0.5.0 — Claude Desktop Issue Fixes

**Date:** 2026-02-20
**Commit:** ebec61f

## What changed

Addressed issues surfaced during Claude Desktop testing of v0.4.0:

1. **Chat HTML stripping improved** — `stripHtml` now handles `<br>` → newline, `<emoji alt="...">` → emoji text, `<attachment>` removal, `</p>` → newline, and HTML entity decoding. Chat listing previews now also strip HTML (previously only drill-down messages were stripped).

2. **Email full-body drill-down** — `ms_mail` now accepts `message_id` parameter to fetch the complete email body (with To/Cc/body). List mode now includes `Message ID` in output for drill-down. HTML email bodies are stripped to plain text.

3. **Transcript meeting subject beta fallback** — When fetching meeting subject in drill-down mode, v1.0 failure with 403/400 now falls back to beta API. Reduces "(Unknown meeting)" occurrences.

4. **Recurring transcript matching fix** — Removed the `transcripts.length <= 1` short-circuit in `matchTranscriptsToEvent`. Previously, a single transcript was shown for ALL occurrences of a recurring meeting. Now a single transcript is only matched to the event within 24 hours of its `createdDateTime`, preventing duplicate transcript IDs across different dates.

## Why

User reported multiple UX issues after testing v0.4.0 with Claude Desktop. The most impactful were: raw HTML in chat messages (confusing for LLMs), no way to read full email bodies, and recurring meetings still showing duplicate transcript IDs.

## Decisions made

- **Triage approach**: Divided 11 reported issues into "actionable fixes" vs "by design / not our bug / future scope". Focused on 4 fixes that improve LLM experience without expanding scope.
- **stripHtml exported from chat.ts**: Made public for testing. Email has its own copy since it needs `<style>`, `<div>`, `<tr>`, `<li>` handling that chat doesn't need.
- **Email drill-down follows transcript pattern**: `message_id` parameter mirrors `transcript_id` — list mode shows IDs, drill-down shows full content.
- **24-hour threshold kept**: Even for single transcripts, the 24h matching window is generous enough for timezone discrepancies while still distinguishing daily recurring meetings.

## Not fixed (by design or future scope)

- `count` validation (clamping to min/max is correct behavior)
- SharePoint search relevance (Graph API indexing, not MCP)
- Empty folder ambiguity (Graph API limitation)
- Read-only scopes (by design)
- Mail/chat pagination (future feature)
- File content reading (future feature)
- Timezone offset in ISO strings (already using Prefer header correctly)

## Context

- 189 tests, 92.8% coverage
- The recurring transcript bug was the most subtle — `matchTranscriptsToEvent` short-circuited on single transcripts, so if only one day of a recurring meeting was recorded, that transcript appeared on every occurrence
